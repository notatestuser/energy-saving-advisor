var angular_app;angular_app=angular.module("npower-challenge",["highcharts-ng"]),angular_app.run(["$rootScope",function(e){window._=exports._}]),angular_app.config(["$routeProvider","$locationProvider",function(e,t){return t.html5Mode(!0).hashPrefix("!"),e.when("/",{templateUrl:"/partials/wizard.html",controller:"MainController"}),e.when("/wizard",{templateUrl:"/partials/wizard.html",controller:"MainController"}),e.otherwise({redirectTo:"/"})}]);var AdviceController,FootprintController,MainController,WeatherTrendsController;MainController=["$rootScope","$scope","consumerDataService","tariffsService","$q",function(e,t,n,r,i){return e.house={},t.availablePanels={weather:!1,household:!1,advice:!1},t.$watch("house",function(e,n){if(e!==n)return t.availablePanels.weather=!0}),t.$watch("house.description",function(t,i){if(t===i)return;return n.findByDescriptionOrPostcode(t,function(t){if(!t)return;return e.house=t,r.getAllTariffs().then(function(n){var r;return r=_.findWhere(n,{regionCode:t.areaCode}),e.regionName=r.regionName})})}),t.$on("householdItemsRegistered",function(){return t.availablePanels.weather=!0,t.availablePanels.household=!0,t.availablePanels.advice=!0})}],WeatherTrendsController=["$rootScope","$scope","consumerDataService","weatherDataService",function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p;return p=t.house,i=p.areaCode,l=p.postcode,o=p.electricityKwh,r.getAreaData(i,function(e,n){return t.chart.series[2].data=e,t.chart.options.yAxis[0].title.text+=" at "+n,t.weatherStationName=n}),h=function(e,t){if(e.wallType===t.wallType)return 0;switch(e.wallType){case"Wall Type Solid Wall":return-1;case"Wall Type Uninsulated Cavity Wall":return t.wallType.match(RegExp("Solid"))?1:-1;case"Wall Type Insulated Cavity Wall":return 1}},u=function(e){return e.postcode.indexOf(t.house.postcode.split(" ")[0])===0},n.findByProperties(u,h,function(e){return t.housesOfSamePostcodeArea=e}),n.getPrincipalConsumptionMonths(function(e){return t.principalConsumptionMonthGasAvg=e.gasAverage[1],t.principalConsumptionMonthElecAvg=e.elecAverage[1],t.principalConsumptionMonthGas=e.gas[0],t.principalConsumptionMonthElec=e.elec[0]}),a=t.house,f=n.getPrincipalConsumptionMonthsForConsumer(a),t.myHighestGasConsumption=f.gasAverage[1].toFixed(0),t.myHighestElecConsumption=f.elecAverage[1].toFixed(0),t.percentageOfMax=function(e,t,n){var r;n==null&&(n=100);switch(e){case"elec":r=3e3;break;case"gas":r=4e3}return Math.min(t/r*n,n)},t.getHouseSizeClass=function(e){var t;t=[];switch(e.bedrooms){case"1 to 2":t.push("size-small");break;case"3":t.push("size-med");break;case"4 +":t.push("size-large")}return e.postcode===l&&e.electricityKwh===o&&t.push("yours"),t},c=0,t.months=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],t.prevMonth=function(){return c=Math.max(c-1,0)},t.nextMonth=function(){return c=Math.min(c+1,12)},t.getMonth=function(){var e;return e=t.months,e[c]},s=function(e){return _.map(_.values(e),function(e){return parseFloat(e)})},t.chart={title:{text:"Energy usage vs climate"},legend:{enabled:!1},series:[{name:"Electricity Usage",color:"#9264aa",type:"column",yAxis:1,data:s(t.house.elecConsumption)},{name:"Gas Usage",color:"#aa8064",type:"column",yAxis:1,data:s(t.house.gasConsumption)},{name:"Max Temperature (deg C)",color:"#7caa64",type:"spline",data:[]}],options:{xAxis:[{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}],yAxis:[{labels:{formatter:function(){return this.value+"°C"},style:{color:"#DDDF0D"},align:"left",x:0,y:-2},showFirstLabel:!1,title:{text:"Temperature",style:{color:"#89A54E"}}},{title:{text:"Energy usage",style:{color:"#4572A7"}},labels:{align:"right",x:0,y:-2,formatter:function(){return this.value+" kWh"},style:{color:"#4572A7"}},showFirstLabel:!1,opposite:!0}],tooltip:{formatter:function(){var e,t;return e=this.series.name,t=e.match(/[A-Za-z ]+Usage$/),""+this.x+": "+Number(this.y).toFixed(1)+(t?" kWh "+e.toLowerCase():"°C")}}}}}],FootprintController=["$scope","stuffRegistry",function(e,t){return e.getItemSelectedClass=function(e,n){var r;return _.isObject(t.stuff[e])?((r=t.stuff[e])!=null?r[n]:void 0)?"selected":"":t.stuff[e]===n?"selected":""}}],AdviceController=["$scope","stuffRegistry",function(e,t){return e.getLoftInsulationRank=function(e){switch(e.loftInsulation){case"Loft Insulation More Than 150mm":return 1;case"Loft Insulation Between 50 and 150mm":return 2;case"Loft Insulation Between 0 and 50mm":return 3;default:return 0}},e.getWallInsulationRank=function(e){switch(e.wallType){case"Wall Type Insulated Cavity Wall":return 1;case"Wall Type Uninsulated Cavity Wall":return 2;case"Wall Type Solid Wall":return 3;default:return 0}},e.getHouseTypeCostRank=function(e){switch(e.propertyType){case"Flat":return 1;case"Terraced":return 2;case"Bungalow":return 3;case"Semi-detached":return 4;case"Detached":return 5;default:return 0}},e.getHouseRoomsRank=function(e){switch(e.bedrooms){case"1 to 2":return 1;case"3":return 2;case"4 +":return 3;default:return 0}},e.isHouseCentrallyHeated=function(e){switch(e.centralHeating){case"Yes":return!0;case"No":return!1;default:return!1}},e.ofgemTypicals={low:[11e3,2100],typical:[16500,3300],high:[23e3,5100]},e.getOfgemUsageRank=function(t){var n,r,i;return i={gasKwh:parseInt(t.gasKwh),elecKwh:parseInt(t.electricityKwh)},n=r="n/a",_.pairs(e.ofgemTypicals).forEach(function(e){var t,s,o,u,a;u=[e[0],e[1]],o=u[0],t=u[1],s=[],i.gasKwh>t[0]&&s.push("gas"),i.elecKwh>t[1]&&s.push("electricity");if(s.length>0)return a=[o,s.join(" and ")],r=a[0],n=a[1],a}),[r,n]},e.getOfgemUsageRankBand=function(t){return e.getOfgemUsageRank(t)[0]},e.getOfgemUsageRankEnergies=function(t){return e.getOfgemUsageRank(t)[1]},e.shouldShowOfgemUsageInSecondColumn=function(t){switch(e.getOfgemUsageRank(t)[0]){case"low":return!0;case"typical":return!0;default:return!1}},e.shouldShowOfgemUsageInFirstColumn=function(t){switch(e.getOfgemUsageRank(t)[0]){case"high":return!0;default:return!1}},e.getOfgemTypicalUsageForBand=function(t,n){switch(t){case"gas":return e.ofgemTypicals[n][0];case"elec":return e.ofgemTypicals[n][1]}},e.householdStuff=t.stuff}],angular_app.directive("wizardStep",["$rootScope",function(e){return{restrict:"C",controller:["$scope","stuffRegistry",function(e,t){return e.currentStep=1,e.showStep=function(t){return e.currentStep=parseInt(t)},e.stuff=t.stuff}],link:function(e,t,n){var r;return r=parseInt(t.data("step")),e.$watch("currentStep",function(e){var n;return e===r?t.addClass("current-step").removeClass("proceeding-step preceeding-step"):(e<r?n="proceeding-step":n="preceeding-step",t.addClass(n).removeClass("current-step"))})}}}]).directive("postcodeTypeaheadBox",["$rootScope","consumerDataService","tariffsService",function($rootScope,consumerDataService,tariffsService){return{restrict:"C",link:function(scope,elem,attrs){return tariffsService.getAllTariffs(),consumerDataService.getAllConsumerData().then(function(consumerData){var descriptions;return descriptions=consumerData.map(function(e){var t;return t=e.propertyType.toLowerCase(),""+e.postcode+", "+t+", "+e.bedrooms+" bedrooms"}),elem.typeahead({source:descriptions,updater:function(description){return scope.$apply(function(){var scopeVar;return scopeVar=attrs.ngModel,eval("scope."+scopeVar+" = '"+description+"'")}),description},highlighter:function(e){return e}})})}}}]).directive("privacyInformationLink",["$rootScope",function(e){return{restrict:"C",link:function(e,t,n){return t.popover({content:n["data-content"]})}}}]).directive("insulatedHouse",[function(){return{restrict:"AC",link:function(e,t,n){var r;return r=function(){switch(e.otherHouse.loftInsulation){case"Loft Insulation Between 0 and 50mm":return"insulation-thin";case"Loft Insulation Between 50 and 150mm":return"insulation-med";case"Loft Insulation More Than 150mm":return"insulation-thick"}}(),t.addClass(r)}}}]).directive("scrollToTargetButton",[function(){return{restrict:"AC",link:function(e,t,n){return(n!=null?n.title:void 0)&&t.parent().tooltip({title:n.title,placement:"right"}),t.click(function(){var e;e=0;if(n!=null?n.dest:void 0)e=$("#"+n.dest).offset().top;return $("html, body").animate({scrollTop:e},1e3)})}}}]).directive("offsetActivatedBehaviour",[function(){return{restrict:"AC",link:function(e,t,n){var r;return r={setSidebarNavColour:function(){var e,n;n=$("#content > section.second").offset().top,e=t.css("color");if(t.offset().top<n){if(e==="rgb(0, 0, 0)")return t.css({color:"rgb(255, 255, 255)"})}else if(e==="rgb(255, 255, 255)")return t.css({color:"rgb(0, 0, 0)"})}},$(window).scroll(function(){var e;return e=$(this).scrollTop(),r[n.behaviour](e)})}}}]).directive("peakConsumptionMonthCircle",["consumerDataService",function(e){return{restrict:"AC",link:function(t,n,r){var i,s;i=t.house,s=e.getPrincipalConsumptionMonthsForConsumer(i),s.gasAverage[1]>0&&t.$watch("principalConsumptionMonthGas",function(e){var r;if(t.month===e)return r=t.principalConsumptionMonthGasAvg,n.removeClass("hidden-phone").addClass("gas-national-average").attr({"data-energy":"gas",title:""+r.toFixed(0)+" kWh"});if(t.month===s.gasMonth)return n.addClass("gas-my-peak")});if(s.elecAverage[1]>0)return t.$watch("principalConsumptionMonthElec",function(e){var r;if(t.month===e)return r=t.principalConsumptionMonthElecAvg,n.removeClass("hidden-phone").addClass("elec-national-average").attr({"data-energy":"electricity",title:""+r.toFixed(0)+" kWh"});if(t.month===s.elecMonth)return n.addClass("elec-my-peak")})}}}]).directive("carousel",[function(){return{restrict:"C",link:function(e,t,n){return t.carousel({interval:!1}),t.find(".carousel-control.left").click(function(){return t.carousel("prev")}),t.find(".carousel-control.right").click(function(){return t.carousel("next")})}}}]).directive("tooltip",[function(){return{restrict:"AC",link:function(e,t,n){return t.tooltip()}}}]),angular.module("highcharts-ng",[]).directive("highchart",function(){var e,t,n;return n=0,e=function(e){return e.forEach(function(e){if(!angular.isDefined(e.id))return e.id="series-"+n++})},t=function(e,t){var n,r;return n={chart:{renderTo:e[0]},title:{},series:[]},r={},t?r=$.extend(!0,{},n,t):r=n,r},{restrict:"EC",replace:!1,scope:{series:"=",options:"=",title:"="},link:function(n,r,i){var s,o;return o=t(r,n.options),s=new Highcharts.Chart(o),n.$watch("series",function(t,n){var r;return e(t),r=[],t.forEach(function(e){var t;return r.push(e.id),t=s.get(e.id),t?t.update(angular.copy(e),!1):s.addSeries(angular.copy(e),!1)}),s.series.forEach(function(e){if(r.indexOf(e.options.id)<0)return e.remove(!1)}),s.redraw()},!0),n.$watch("title",function(e){return s.setTitle(e,!0)},!0),n.$watch("options",function(n,i,u){if(n===i)return;return s.destroy(),o=t(r,n),s=new Highcharts.Chart(o),s.setTitle(u.title,!0),e(u.series),u.series.forEach(function(e){return s.addSeries(angular.copy(e),!1)}),s.redraw()},!0)}}});var APPLIANCES_ENDPOINT,CONSUMER_DATA_ENDPOINT,REGION_TARIFFS_ENDPOINT,WEATHER_DATA_ENDPOINT,fetchOrCacheXml,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};REGION_TARIFFS_ENDPOINT="/data/regionTariffs.xml",CONSUMER_DATA_ENDPOINT="/data/consumerData.xml",APPLIANCES_ENDPOINT="/data/appliances.xml",WEATHER_DATA_ENDPOINT="/data/metWeatherData.json",fetchOrCacheXml=function(e,t,n,r){var i,s;return i=__indexOf.call(window,"localStorage")>=0&&window["localStorage"]!=null,!i||!localStorage[e]?$.ajax({dataType:"xml",url:e,success:function(s){return r.$apply(function(){return i&&(localStorage[e]=s),t.resolve(n(s))})},error:t.reject}):(s=localStorage[e],t.resolve(n(s)))},angular_app.factory("tariffsService",["$q","$rootScope","$http",function(e,t,n){return{getAllTariffs:function(){var n;return n=e.defer(),fetchOrCacheXml(REGION_TARIFFS_ENDPOINT,n,function(e){var t;return t=["//region",{regionCode:"@regionCode",regionName:"@regionName",tariffs:["tariffs/tariff",{name:"@name",electricity:{standingCharge:'fuel[@fuelType="E"]/@standingCharge',unitRate:'fuel[@fuelType="E"]/@unitRate'},gas:{standingCharge:'fuel[@fuelType="G"]/@standingCharge',unitRate:'fuel[@fuelType="G"]/@unitRate'}}]}],Jath.parse(t,e)},t),n.promise}}}]).factory("consumerDataService",["$q","$rootScope","$http",function(e,t,n){var r;return r={},_.extend(r,{getAllConsumerData:function(){var n;return n=e.defer(),fetchOrCacheXml(CONSUMER_DATA_ENDPOINT,n,function(e){var t,n;return n=["//consumptionData",{currentSupplier:"@currentSupplier",tariff:"@tariff",postcode:"@Postcode",areaCode:"@areaCode",propertyType:"@propertyType",bedrooms:"@bedrooms",propertyBuilt:"@propertyBuilt",numberofBathrooms:"@numberofBathrooms",electricityKwh:"@electricityKwh",gasKwh:"@gasKwh",centralHeating:"@centralHeating",loftInsulation:"@loftInsulation",wallType:"@wallType",gasConsumption:{jan:"gasConsumption/@jan",feb:"gasConsumption/@feb",mar:"gasConsumption/@mar",apr:"gasConsumption/@apr",may:"gasConsumption/@may",jun:"gasConsumption/@jun",jul:"gasConsumption/@jul",aug:"gasConsumption/@aug",sep:"gasConsumption/@sep",oct:"gasConsumption/@oct",nov:"gasConsumption/@nov",dec:"gasConsumption/@dec"},elecConsumption:{jan:"elecConsumption/@jan",feb:"elecConsumption/@feb",mar:"elecConsumption/@mar",apr:"elecConsumption/@apr",may:"elecConsumption/@may",jun:"elecConsumption/@jun",jul:"elecConsumption/@jul",aug:"elecConsumption/@aug",sep:"elecConsumption/@sep",oct:"elecConsumption/@oct",nov:"elecConsumption/@nov",dec:"elecConsumption/@dec"}}],t=Jath.parse(n,e),t},t),n.promise},findByPostcode:function(e,t){return r.getAllConsumerData().then(function(n){var r;return r=_.findWhere(n,{postcode:e}),r&&(r.foundViaWebService=!0),typeof t=="function"?t(r):void 0})},findByDescriptionOrPostcode:function(e,t){var n,i;i=/([a-zA-Z0-9 ]+)(, ([a-z\-]+), ([a-z0-9 +]+) bedrooms)?/,n=e.match(i);if(!n)return;return r.getAllConsumerData().then(function(r){var i,s;s={postcode:n[1].toUpperCase()},n[3]&&(s.propertyType=_.first(n[3]).toUpperCase()+n[3].slice(1)),n[4]&&(s.bedrooms=n[4]),i=_.findWhere(r,s);if(!i)return;return i.description=e,i&&(i.foundViaWebService=!0),typeof t=="function"?t(i):void 0})},findByProperties:function(e,t,n){return r.getAllConsumerData().then(function(r){var i;return typeof e!="function"?i=_.where(r,e):i=_.select(r,e),t&&(i=i.sort(t)),typeof n=="function"?n(i):void 0})},getTotalMonthlyConsumption:function(e){return r.getAllConsumerData().then(function(t){var n;return n=_(["elecConsumption","gasConsumption"]).map(function(e){return[e,_(t).reduce(function(t,n){return _.pairs(n[e]).forEach(function(e){return t[e[0]]+=parseFloat(e[1])}),t},{jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0})]}),typeof e=="function"?e(_.object(n),t.length):void 0})},getPrincipalConsumptionMonths:function(e){return r.getTotalMonthlyConsumption(function(t,n){var i,s;return s=r,i=s.getPrincipalConsumptionMonthsForConsumer(t,n),typeof e=="function"?e(i):void 0})},getPrincipalConsumptionMonthsForConsumer:function(e,t){var n,r,i;return t==null&&(t=1),i=function(e){return parseFloat(e[1])},{gas:r=_.max(_.pairs(e.gasConsumption),i),elec:n=_.max(_.pairs(e.elecConsumption),i),gasMonth:r[0],elecMonth:n[0],gasAverage:[r[0],r[1]/t],elecAverage:[n[0],n[1]/t]}}})}]).factory("appliancesService",["$q","$rootScope","$http",function(e,t,n){return{getAllTariffs:function(){var n;return n=e.defer(),fetchOrCacheXml(APPLIANCES_ENDPOINT,n,function(e){var t;return t=["//appliance",{name:"@name",wattage:"@wattage"}],Jath.parse(t,e)},t),n.promise}}}]).factory("weatherDataService",["$http",function(e){var t;return t={},_.extend(t,{getWeatherData:function(){return e.get(WEATHER_DATA_ENDPOINT)},getAreaData:function(e,n){return t.getWeatherData().success(function(t){var r,i,s;return i=_.findWhere(t,{regionCode:parseInt(e)}),r=_.values(i.monthlyData),s=_.map(_.pluck(r,"maxDegC"),function(e){return parseFloat(e)}),n(s,i.station)})}})}]).factory("stuffRegistry",["$rootScope",function(e){var t,n,r;return n={stuff:{fields:{}}},r=function(t,r){return n.stuff.fields[t]=r,e.$broadcast("householdItemsRegistered")},t=function(e){return n.stuff.fields[e]},["lighting","television","standby"].forEach(function(e){return n.stuff.__defineSetter__(e,r.bind(this,e)),n.stuff.__defineGetter__(e,t.bind(this,e))}),n}])